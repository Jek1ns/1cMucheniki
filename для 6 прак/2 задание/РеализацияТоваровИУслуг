Процедура ОбработкаПроведения(Отказ, Режим)
	
	// Движения по партиям товаров (расход товаров)
	Движения.ПартииТоваров.Записывать = Истина;
	Для Каждого ТекСтрокаТовары Из ТоварыИУслуги Цикл
		Движение              = Движения.ПартииТоваров.Добавить();
		Движение.ВидДвижения  = ВидДвиженияНакопления.Расход; // Товары уходят
		Движение.Регистратор  = Ссылка;
		Движение.Период       = Дата;
		Движение.Склад        = Склад;
		Движение.Номенклатура = ТекСтрокаТовары.Номенклатура;
		Движение.Партия       = ТекСтрокаТовары.Партия;
		Движение.Количество   = ТекСтрокаТовары.Количество;
		Движение.Сумма        = ТекСтрокаТовары.Сумма;
	КонецЦикла;
	
	// Движения по взаиморасчетам (увеличение долга контрагента перед нами)
	Движения.Взаиморасчеты.Записывать = Истина;
	ДвижениеВзаиморасчетов = Движения.Взаиморасчеты.Добавить();
	ДвижениеВзаиморасчетов.ВидДвижения = ВидДвиженияНакопления.Приход; // Долг контрагента увеличивается
	ДвижениеВзаиморасчетов.Период = Дата;
	ДвижениеВзаиморасчетов.Контрагент = Контрагент;
	ДвижениеВзаиморасчетов.Договор = Договор;
	ДвижениеВзаиморасчетов.Сумма = СуммаДокумента; // Общая сумма документа
	
КонецПроцедуры
